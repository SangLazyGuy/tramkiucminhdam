<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <title>Flipbook</title>

  <audio id="bgMusic" loop>
    <source src="nhacnen.mp3" type="audio/mpeg">
  </audio>
</head>

<body>

  <div class="flipbook">

      <!-- Trang 1 -->
      <div class="hard">My Pokemon Gallery <small>~ HankTheTank</small></div>

      <!-- Trang 2 -->
      <div class="hard"></div>

      <!-- Trang 3 (VIDEO) -->
      <div class="page video-page video-placeholder" data-video="video1"></div>

      <!-- Trang 4+ (ẢNH) — đúng chuẩn -->
      <div class="page"><img src="a.jpg" /></div>
      <div class="page"><img src="a.jpg" /></div>
      <div class="page"><img src="b.jpg" /></div>
      <div class="page"><img src="c.jpg" /></div>
      <div class="page"><img src="d.jpg" /></div>

      <!-- Trang cuối -->
      <div class="hard"></div>
      <div class="hard">Thank You <small>~ HankTheTank</small></div>

  </div>

  <!-- VIDEO OVERLAY -->
  <div id="video-container">
    <video id="video1" class="video-ui" src="video1.mp4"></video>
    <input type="range" id="seek1" class="seekbar" value="0" min="0" max="100">
  </div>

  <!-- Scripts -->
  <script src="jquery.js"></script>
  <script src="turn.js"></script>

  <script>
    $(".flipbook").turn();
  </script>

  <!-- Giữ nhạc -->
  <script>
    const audio = document.getElementById("bgMusic");
    function restoreAudioTime() {
      const saved = localStorage.getItem("bgMusicTime");
      if (saved) audio.currentTime = parseFloat(saved);
    }
    audio.addEventListener("loadedmetadata", restoreAudioTime);
    audio.play().catch(()=>{});
    window.addEventListener("beforeunload", ()=> {
      localStorage.setItem("bgMusicTime", audio.currentTime);
    });
  </script>

  <!-- VIDEO OVERLAY SCRIPT -->
  <script>
    $(".flipbook").turn({
      when: {
        turned: function (e, page) {

          const vc = document.getElementById("video-container");
          vc.style.display = "none";

          const pageEl = $(".flipbook .page").eq(page - 1);
          const videoId = pageEl.data("video");

          if (videoId) {
              const rect = pageEl[0].getBoundingClientRect();

              vc.style.left = rect.left + "px";
              vc.style.top = rect.top + "px";
              vc.style.display = "block";

              const video = document.getElementById(videoId);
              const seek = document.getElementById("seek1");

              video.currentTime = 0;
              video.play();

              video.onloadedmetadata = () => {
                seek.max = Math.floor(video.duration * 10);
              };

              seek.oninput = () => {
                video.currentTime = seek.value / 10;
              };

              function updateSeek() {
                seek.value = Math.floor(video.currentTime * 10);
                requestAnimationFrame(updateSeek);
              }
              updateSeek();
          }
        }
      }
    });
  </script>

</body>
</html>
