<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>Flipbook</title>
</head>

<body>

<div class="flipbook-wrapper">
    
    <div class="flipbook">
        <div class="hard">My Pokemon Gallery</div>
        <div class="hard"></div>

        <div class="page" data-video="video1"></div>

        <div><img src="a.jpg"></div>
        <div><img src="b.jpg"></div>
        <div><img src="c.jpg"></div>
        <div><img src="d.jpg"></div>

        <div class="hard"></div>
        <div class="hard">Thank You</div>
    </div>

    <!-- VIDEO không bỏ trong trang nữa, nhưng đặt CHUNG wrapper -->
    <div id="video-overlay">
        <video id="video1" src="video1.mp4"></video>
        <input type="range" id="seek1" class="seekbar" min="0" value="0">
    </div>

</div>

<script src="jquery.js"></script>
<script src="turn.js"></script>

<script>
$(".flipbook").turn({
    when:{
        turned: function(e, page){
            const overlay = document.getElementById("video-overlay");
            overlay.style.display = "none";

            const pageEl = $(".flipbook .page").eq(page-1);
            const videoId = pageEl.data("video");

            if(videoId){
                const rect = pageEl[0].getBoundingClientRect();
                const wrapperRect = document.querySelector(".flipbook-wrapper").getBoundingClientRect();

                // căn theo position absolute trong wrapper
                overlay.style.left = (rect.left - wrapperRect.left) + "px";
                overlay.style.top  = (rect.top  - wrapperRect.top ) + "px";

                overlay.style.display = "block";

                let video = document.getElementById(videoId);
                let seek  = document.getElementById("seek1");

                video.currentTime = 0;
                video.play();

                video.onloadedmetadata = () => seek.max = Math.floor(video.duration * 10);

                seek.oninput = ()=>{
                    video.currentTime = seek.value / 10;
                    video.play();
                };

                function sync(){
                    if(!video.paused){
                        seek.value = Math.floor(video.currentTime * 10);
                    }
                    requestAnimationFrame(sync);
                }
                sync();
            }
        }
    }
});
</script>

<script>
function scaleFlipbook(){
    const wrapper = document.querySelector(".flipbook-wrapper");
    const book = document.querySelector(".flipbook");

    const scale = wrapper.clientWidth / 1123;

    book.style.transform = `scale(${scale})`;
    document.getElementById("video-overlay").style.transform = `scale(${scale})`;
}

scaleFlipbook();
window.addEventListener("resize", scaleFlipbook);
</script>

</body>
</html>
