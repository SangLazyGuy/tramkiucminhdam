<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>Flipbook</title>
</head>

<body>

<div class="flipbook">
    <div class="hard">My Pokemon Gallery <small>~ Hank</small></div>
    <div class="hard"></div>

    <!-- Trang có video -->
    <div class="page" data-video="video1"></div>

    <div><img src="a.jpg"></div>
    <div><img src="b.jpg"></div>
    <div><img src="c.jpg"></div>
    <div><img src="d.jpg"></div>

    <div class="hard"></div>
    <div class="hard">Thanks <small>~ Hank</small></div>
</div>

<!-- VIDEO OVERLAY (luôn click được) -->
<div id="video-overlay">
    <video id="video1" src="video1.mp4"></video>
    <input type="range" id="seek1" class="seekbar" min="0" value="0">
</div>

<script src="jquery.js"></script>
<script src="turn.js"></script>

<script>
$(".flipbook").turn({
    elevation: 50,
    gradients: true,
    acceleration: true,
    when:{
        turned: function(e, page){

            const overlay = document.getElementById("video-overlay");
            overlay.style.display = "none";

            const pageEl = $(".flipbook .page").eq(page-1);
            const videoId = pageEl.data("video");

            if(videoId){
                const rect = pageEl[0].getBoundingClientRect();
                const overlay = document.getElementById("video-overlay");

                overlay.style.left = rect.left + "px";
                overlay.style.top  = rect.top  + "px";
                overlay.style.display = "block";

                const video = document.getElementById(videoId);
                const seek  = document.getElementById("seek1");

                video.currentTime = 0;
                video.play();

                video.onloadedmetadata = ()=> seek.max = Math.floor(video.duration*10);

                seek.oninput = ()=>{
                    video.currentTime = seek.value / 10;
                    video.play();
                };

                function sync(){
                    if(!video.paused){
                        seek.value = Math.floor(video.currentTime * 10);
                    }
                    requestAnimationFrame(sync);
                }
                sync();
            }
        }
    }
});
</script>

</body>
</html>
